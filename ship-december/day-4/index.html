<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Day 4</title>
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Cardo:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
   <style>
      * { box-sizing: border-box; }

      html {
         overflow-x: hidden;
      }

      body {
         font-family: 'Cardo', Georgia, serif;
         line-height: 1.6;
         margin: 0;
         padding: 0;
         display: flex;
         overflow-x: hidden;
      }

      /* Sidebar */
      .sidebar {
         width: 220px;
         min-height: 100vh;
         background: #fff;
         border-right: 1px solid #e0e0e0;
         position: fixed;
         left: 0;
         top: 0;
         overflow-y: auto;
         font-family: "SF Mono", "Monaco", "Inconsolata", "Fira Mono", "Droid Sans Mono", "Source Code Pro", ui-monospace, monospace;
         font-size: 1rem;
      }

      .sidebar-header {
         padding: 1.5rem 1rem 1rem;
         font-weight: 700;
         font-size: 1.1rem;
         border-bottom: 1px solid #e0e0e0;
      }

      .sidebar-item {
         border-bottom: 1px solid #eee;
      }

      .sidebar-item-row {
         display: flex;
         align-items: stretch;
      }

      .day-link {
         flex: 1;
         padding: 0.75rem 1rem;
         color: #000;
         text-decoration: none;
         display: block;
      }

      .day-link:hover {
         background: #f5f5f5;
      }

      .sidebar-item.active .day-link {
         font-weight: 700;
      }

      .chevron-container {
         display: flex;
         align-items: center;
         justify-content: center;
         width: 40px;
         border-left: 1px solid #eee;
         cursor: pointer;
         user-select: none;
      }

      .chevron-container:hover {
         background: #f5f5f5;
      }

      .chevron {
         font-size: 0.8rem;
         color: #666;
         transition: transform 0.2s ease;
      }

      .sidebar-item.expanded .chevron {
         transform: rotate(180deg);
      }

      .appendices-tree {
         display: none;
         background: #fafafa;
         border-top: 1px solid #eee;
      }

      .sidebar-item.expanded .appendices-tree {
         display: block;
      }

      .appendix-item {
         padding: 0.5rem 1rem 0.5rem 2rem;
         font-size: 0.8rem;
         cursor: pointer;
         border-bottom: 1px solid #eee;
         white-space: nowrap;
         overflow: hidden;
         text-overflow: ellipsis;
      }

      .appendix-item:last-child {
         border-bottom: none;
      }

      .appendix-item:hover {
         background: #f0f0f0;
      }

      /* Main content */
      .main-content {
         margin-left: 220px;
         flex: 1;
         max-width: 800px;
         padding: 2rem 2rem 2rem 3.5rem;
      }

      /* Modal */
      .modal {
         display: none;
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background: rgba(0, 0, 0, 0.3);
         z-index: 1000;
         justify-content: center;
         align-items: center;
      }

      .modal.open {
         display: flex;
      }

      .modal-content {
         background: #fff;
         border: 1px solid #000;
         box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
         max-width: 800px;
         width: 90%;
         max-height: 80vh;
         position: relative;
         display: flex;
         flex-direction: column;
      }

      .modal-close {
         position: absolute;
         top: 0.5rem;
         right: 0.75rem;
         background: none;
         border: none;
         font-size: 1.5rem;
         cursor: pointer;
         color: #000;
         line-height: 1;
      }

      .modal-close:hover {
         color: #666;
      }

      .modal-body {
         padding: 2rem;
         overflow-y: auto;
         font-family: 'Cardo', Georgia, serif;
         line-height: 1.6;
      }

      .modal-body pre {
         background: #f4f4f4;
         padding: 1em;
         overflow-x: auto;
         border-radius: 5px;
      }

      .modal-body code {
         background: #f4f4f4;
         padding: 0.2em 0.4em;
         border-radius: 3px;
      }

      .modal-body pre code {
         background: none;
         padding: 0;
      }

      /* Responsive sidebar */
      @media (max-width: 800px) {
         .sidebar {
            width: 125px;
         }
         .main-content {
            margin-left: 125px;
            padding: 1.5rem 1.5rem 1.5rem 2rem;
         }
         .appendix-item {
            padding: 0.5rem 0.5rem 0.5rem 1rem;
         }
         .chevron-container {
            width: 30px;
         }
      }

      /* Sidebar expanded state (swipe to expand) */
      .sidebar {
         transition: width 0.3s ease;
      }
      .main-content {
         transition: margin-left 0.3s ease, opacity 0.3s ease;
      }
      body.sidebar-expanded .sidebar {
         width: 80vw;
         z-index: 100;
      }
      body.sidebar-expanded .main-content {
         margin-left: 80vw;
         opacity: 0.3;
         cursor: pointer;
      }
      @media (max-width: 800px) {
         body.sidebar-expanded .sidebar {
            width: 85vw;
         }
         body.sidebar-expanded .main-content {
            margin-left: 85vw;
         }
      }

      /* Post content styles */
      h1, h2, h3, h4, h5, h6 { margin-top: 1.5em; margin-bottom: 0.5em; }
      h1 { border-bottom: 2px solid #eee; padding-bottom: 0.3em; }
      a { color: #0066cc; }
      code { background: #f4f4f4; padding: 0.2em 0.4em; border-radius: 3px; }
      pre { background: #f4f4f4; padding: 1em; overflow-x: auto; border-radius: 5px; }
      pre code { background: none; padding: 0; }
      img { max-width: 100%; height: auto; border: 1px solid #ddd; }
      hr { border: none; border-top: 1px solid #a1a1a1; margin: 2em 0; }
      blockquote {
         margin: 1.5em 0;
         padding: 1em 1.5em;
         background: #f9f9f9;
         border-left: 4px solid #333;
      }
      blockquote p { margin: 0; }

      /* Cards */
      .card {
         margin-bottom: 0;
      }

      /* Comments */
      .comments-section {
         margin-top: 3rem;
         padding-top: 2rem;
         border-top: 2px solid #333;
      }
      .comments-section h2 {
         margin-top: 0;
         font-size: 1.2rem;
         color: #666;
      }
      .comment {
         background: #f9f9f9;
         border-left: 3px solid #ccc;
         padding: 0.75rem 1rem;
         margin: 1rem 0;
         font-size: 0.95rem;
      }
      .comment p {
         margin: 0;
      }
   </style>
</head>
<body>
   
   <nav class="sidebar">
      <div class="sidebar-header">Ship December</div>
      
      <div class="sidebar-item">
         <div class="sidebar-item-row">
            <a href="/ship-december/day-1" class="day-link">Day 1</a>
            
         </div>
         
      </div>
      <div class="sidebar-item">
         <div class="sidebar-item-row">
            <a href="/ship-december/day-2" class="day-link">Day 2</a>
            
         </div>
         
      </div>
      <div class="sidebar-item">
         <div class="sidebar-item-row">
            <a href="/ship-december/day-3" class="day-link">Day 3</a>
            <div class="chevron-container"><span class="chevron">&#9662;</span></div>
         </div>
         <div class="appendices-tree"><div class="appendix-item" data-path="/ship-december/day-3/appendices/jarred-claude-code-transcript.md" data-name="jarred-claude-code-transcript.md">jarred-claude-code-transcript.md</div><div class="appendix-item" data-path="/ship-december/day-3/appendices/jarred-margin.md" data-name="jarred-margin.md">jarred-margin.md</div></div>
      </div>
      <div class="sidebar-item active expanded">
         <div class="sidebar-item-row">
            <a href="/ship-december/day-4" class="day-link">Day 4</a>
            <div class="chevron-container"><span class="chevron">&#9662;</span></div>
         </div>
         <div class="appendices-tree"><div class="appendix-item" data-path="/ship-december/day-4/appendices/jarred-claude-code-transcript.md" data-name="jarred-claude-code-transcript.md">jarred-claude-code-transcript.md</div><div class="appendix-item" data-path="/ship-december/day-4/appendices/jarred-margin.md" data-name="jarred-margin.md">jarred-margin.md</div></div>
      </div>
   </nav>
   <main class="main-content">
      <article class="card" data-file="ship-december/day-4/post.md"><p><em>[ Jarred 7.30am ]</em></p>
<p>Good morning</p>
<p>I&#39;m a little bit in-the-sea.</p>
<p>I&#39;m not drowning because I&#39;m not thrashing about and the waves are not so uppity.</p>
<p>It would be nice to get dry and to get warm though before I start working in earnest.</p>
</article>
<hr>
<article class="card" data-file="ship-december/day-4/post.md"><p><em>[ Jarred 10.10am ]</em></p>
<p>Well, I just spent 2-3 hours writing into [[day-4/appendices/jarred-margin]].</p>
<p>I sort of have a plan for something to ship. Let&#39;s see if we can add a comment system by turning these markdown files into &quot;cards&quot; by splitting on &quot;- - -&quot;. Then we can add a github action or a cloudflare function which appends a &quot;card&quot; to the post by appending something to post.md like:</p>
<pre><code> - - -
user: harri
type: comment

banger stuff
</code></pre>
<p>I guess the MVP could just support anon comments, or something that starts with &quot;From: Harri&quot;. We probably do need to know it&#39;s a comment to style it appropriately.</p>
<p>We&#39;ll also need to be able to add meta data if the comment is &quot;inline&quot; like a gdoc comment.</p>
</article>
<hr>
<article class="card" data-file="ship-december/day-4/post.md"><p>Of course!</p>
<p>Ok so today&#39;s ideal features would be:</p>
<ol start="0">
<li>Introduce cards as a primitive</li>
<li>Add tooling to add cards to margin using the librarian</li>
<li>Make the librarian easier to access</li>
<li>Add tooling to add cards to comments.md</li>
</ol>
</article>
      <section class="comments-section">
         <h2>Comments</h2>
         <article class="comment" data-file="ship-december/day-4/comments.md"><p>your comment here</p>
</article>
<article class="comment" data-file="ship-december/day-4/comments.md"><p>your comment here</p>
</article>
<article class="comment" data-file="ship-december/day-4/comments.md"><p>your comment hereasdfasdf</p>
</article>
      </section>
   </main>
   
   <div id="appendix-modal" class="modal">
      <div class="modal-content">
         <button class="modal-close">&times;</button>
         <div class="modal-body"></div>
      </div>
   </div>
   
   <script>
      // Chevron toggle for appendices
      document.querySelectorAll('.chevron-container').forEach(chevron => {
         chevron.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            const item = chevron.closest('.sidebar-item');
            item.classList.toggle('expanded');
         });
      });

      // Modal handling
      const modal = document.getElementById('appendix-modal');
      const modalBody = modal.querySelector('.modal-body');
      const modalClose = modal.querySelector('.modal-close');

      document.querySelectorAll('.appendix-item').forEach(item => {
         item.addEventListener('click', async () => {
            const path = item.dataset.path;
            const name = item.dataset.name;

            try {
               const response = await fetch(path);
               let content = await response.text();

               // If markdown, render it
               if (name.endsWith('.md')) {
                  // Basic markdown rendering (or use marked if available)
                  content = content
                     .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                     .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                     .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                     .replace(/\*\*(.*)\*\*/gim, '<strong>$1</strong>')
                     .replace(/\*(.*)\*/gim, '<em>$1</em>')
                     .replace(/```([\s\S]*?)```/gim, '<pre><code>$1</code></pre>')
                     .replace(/`([^`]+)`/gim, '<code>$1</code>')
                     .replace(/\n/gim, '<br>');
               } else {
                  content = '<pre>' + content.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</pre>';
               }

               modalBody.innerHTML = '<h2>' + name + '</h2>' + content;
               modal.classList.add('open');
            } catch (err) {
               modalBody.innerHTML = '<p>Error loading file: ' + err.message + '</p>';
               modal.classList.add('open');
            }
         });
      });

      modalClose.addEventListener('click', () => {
         modal.classList.remove('open');
      });

      modal.addEventListener('click', (e) => {
         if (e.target === modal) {
            modal.classList.remove('open');
         }
      });

      document.addEventListener('keydown', (e) => {
         if (e.key === 'Escape') {
            modal.classList.remove('open');
         }
      });

      // Swipe to expand sidebar
      const sidebar = document.querySelector('.sidebar');
      const mainContent = document.querySelector('.main-content');
      let touchStartX = 0;
      let touchEndX = 0;

      sidebar.addEventListener('touchstart', (e) => {
         touchStartX = e.changedTouches[0].screenX;
      }, { passive: true });

      sidebar.addEventListener('touchend', (e) => {
         touchEndX = e.changedTouches[0].screenX;
         if (touchEndX - touchStartX > 50) {
            document.body.classList.add('sidebar-expanded');
         } else if (touchStartX - touchEndX > 50) {
            document.body.classList.remove('sidebar-expanded');
         }
      }, { passive: true });

      mainContent.addEventListener('click', () => {
         if (document.body.classList.contains('sidebar-expanded')) {
            document.body.classList.remove('sidebar-expanded');
         }
      });
   </script>
</body>
</html>