(function () { "use strict"; class r { constructor(t) { this.chunks = [], this.readIndex = 0, this.readOffset = 0, this.totalLength = 0, this.TypedArrayConstructor = t } clear() { this.chunks = [], this.totalLength = 0, this.readIndex = 0, this.readOffset = 0 } enqueue(t) { t.length !== 0 && (this.chunks.push(t), this.totalLength += t.length) } dequeue(t) { if (t <= 0) throw new Error("Invalid argument: 'count' must be a positive integer"); const i = new this.TypedArrayConstructor(t); let e = 0; for (; e < t && !(this.readIndex >= this.chunks.length);) { const s = this.chunks[this.readIndex], n = s.length - this.readOffset, a = Math.min(n, t - e); i.set(s.subarray(this.readOffset, this.readOffset + a), e), this.readOffset += a, e += a, this.readOffset >= s.length && (this.readIndex += 1, this.readOffset = 0) } return this.totalLength -= e, this.readIndex > 0 && (this.chunks.splice(0, this.readIndex), this.readIndex = 0), i } get length() { return this.totalLength } } class h extends AudioWorkletProcessor { constructor() { super(), this.queue = new r(Float32Array), this.state = "idle", this.lastEmittedTime = 0, this.currentTime = 0, this.port.onmessage = t => { t.data.audioData && (this.queue.length === 0 && this.port.postMessage({ state: "playing" }), this.queue.enqueue(t.data.audioData)), t.data.play && this.state === "paused" && (this.queue.length === 0 ? (this.state = "idle", this.port.postMessage({ state: "idle" })) : (this.state = "playing", this.port.postMessage({ state: "playing" }))), t.data.pause && this.state !== "paused" && (this.state = "paused", this.port.postMessage({ state: "paused" })), t.data.clear && this.queue.length > 0 && (this.queue.clear(), this.currentTime = 0, this.state = "idle", this.port.postMessage({ state: "idle", currentTime: 0 })) } } process(t, i) { const e = i[0][0]; if (this.state === "paused") return !0; if (this.queue.length > 0) { const s = this.queue.dequeue(e.length); e.set(s), this.currentTime += s.length / 24e3, this.state === "idle" ? (this.state = "playing", this.port.postMessage({ state: "playing", currentTime: this.currentTime })) : this.queue.length === 0 ? (this.state = "idle", this.port.postMessage({ state: "idle", currentTime: 0 }), this.currentTime = 0) : this.currentTime - this.lastEmittedTime > .5 && (this.lastEmittedTime = this.currentTime, this.port.postMessage({ currentTime: this.currentTime })) } return !0 } } registerProcessor("audio-player", h) })();